<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="theme-color" content="#0f0f13"/>
<meta name="description" content="Orbi â€” Organizador Personal y AcadÃ©mico"/>
<title>Orbi â€” Organizador Personal</title>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet"/>
<style>
  :root {
    --bg:#0f0f13;--bg2:#17171f;--bg3:#1e1e28;
    --border:rgba(255,255,255,0.07);
    --text:#f0f0f5;--text2:#8888aa;--text3:#555570;
    --accent:#7c6af7;--accent-glow:rgba(124,106,247,0.3);
    --green:#4ade80;--orange:#fb923c;--red:#f87171;--yellow:#facc15;--pink:#f472b6;--cyan:#22d3ee;
    --radius:16px;--radius-sm:10px;--shadow:0 4px 24px rgba(0,0,0,0.4);
    --font:'Outfit',sans-serif;--mono:'Space Mono',monospace;
    --nav-w:72px;--transition:0.2s cubic-bezier(.4,0,.2,1);
  }
  .light{
    --bg:#f4f4f9;--bg2:#ffffff;--bg3:#eaeaf3;
    --border:rgba(0,0,0,0.08);--text:#111118;--text2:#555570;--text3:#9999b0;
    --accent-glow:rgba(124,106,247,0.15);--shadow:0 4px 24px rgba(0,0,0,0.1);
  }
  *{box-sizing:border-box;margin:0;padding:0;}
  body{font-family:var(--font);background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden;transition:background var(--transition),color var(--transition);}
  #root{display:flex;height:100vh;}

  /* â”€â”€ AUTH â”€â”€ */
  .auth-page{min-height:100vh;width:100%;display:flex;align-items:center;justify-content:center;background:var(--bg);position:relative;overflow:hidden;}
  .auth-glow{position:absolute;width:600px;height:600px;border-radius:50%;background:radial-gradient(circle,rgba(124,106,247,0.12) 0%,transparent 70%);pointer-events:none;}
  .auth-card{background:var(--bg2);border:1px solid var(--border);border-radius:24px;padding:40px;width:100%;max-width:420px;position:relative;z-index:1;box-shadow:0 24px 64px rgba(0,0,0,0.4);}
  .auth-logo{font-size:52px;font-weight:800;color:var(--accent);letter-spacing:-3px;text-align:center;margin-bottom:4px;}
  .auth-tagline{text-align:center;color:var(--text2);font-size:14px;margin-bottom:32px;}
  .auth-tabs{display:flex;background:var(--bg3);padding:4px;border-radius:12px;margin-bottom:24px;}
  .auth-tab{flex:1;padding:10px;border-radius:9px;border:none;background:none;color:var(--text2);font-family:var(--font);font-size:14px;font-weight:600;cursor:pointer;transition:all var(--transition);}
  .auth-tab.active{background:var(--bg2);color:var(--text);box-shadow:var(--shadow);}
  .auth-error{background:rgba(248,113,113,0.1);border:1px solid rgba(248,113,113,0.3);color:var(--red);border-radius:10px;padding:12px;font-size:13px;margin-bottom:16px;}

  /* â”€â”€ NAV â”€â”€ */
  .nav{width:var(--nav-w);background:var(--bg2);border-right:1px solid var(--border);display:flex;flex-direction:column;align-items:center;padding:20px 0;gap:4px;position:fixed;left:0;top:0;bottom:0;z-index:100;}
  .nav-logo{font-size:22px;font-weight:800;color:var(--accent);letter-spacing:-1px;margin-bottom:20px;}
  .nav-item{width:48px;height:48px;border-radius:14px;display:flex;align-items:center;justify-content:center;cursor:pointer;color:var(--text3);transition:all var(--transition);position:relative;border:none;background:none;}
  .nav-item:hover{background:var(--bg3);color:var(--text2);}
  .nav-item.active{background:var(--accent-glow);color:var(--accent);}
  .nav-item.active::before{content:'';position:absolute;left:-1px;width:3px;height:24px;background:var(--accent);border-radius:0 4px 4px 0;}
  .nav-bottom{margin-top:auto;display:flex;flex-direction:column;gap:4px;}

  /* â”€â”€ MAIN â”€â”€ */
  .main{margin-left:var(--nav-w);flex:1;overflow-y:auto;padding:32px;display:flex;flex-direction:column;gap:24px;}
  .page-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;}
  .page-title{font-size:28px;font-weight:700;letter-spacing:-0.5px;}
  .page-title span{color:var(--accent);}

  /* â”€â”€ CARDS â”€â”€ */
  .card{background:var(--bg2);border:1px solid var(--border);border-radius:var(--radius);padding:24px;transition:background var(--transition);}
  .card-title{font-size:12px;font-weight:600;text-transform:uppercase;letter-spacing:1.5px;color:var(--text3);margin-bottom:16px;}

  /* â”€â”€ GRID â”€â”€ */
  .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:20px;}
  .grid-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:20px;}
  .grid-4{display:grid;grid-template-columns:repeat(4,1fr);gap:16px;}

  /* â”€â”€ BUTTONS â”€â”€ */
  .btn{padding:10px 20px;border-radius:var(--radius-sm);border:none;cursor:pointer;font-family:var(--font);font-size:14px;font-weight:600;transition:all var(--transition);display:inline-flex;align-items:center;gap:8px;}
  .btn-primary{background:var(--accent);color:#fff;box-shadow:0 4px 16px var(--accent-glow);}
  .btn-primary:hover{filter:brightness(1.1);transform:translateY(-1px);}
  .btn-primary:disabled{opacity:0.5;cursor:not-allowed;transform:none;}
  .btn-ghost{background:var(--bg3);color:var(--text2);}
  .btn-ghost:hover{color:var(--text);}
  .btn-danger{background:rgba(248,113,113,0.15);color:var(--red);}
  .btn-danger:hover{background:rgba(248,113,113,0.25);}
  .btn-sm{padding:6px 14px;font-size:13px;border-radius:8px;}
  .btn-icon{width:36px;height:36px;padding:0;border-radius:10px;justify-content:center;}

  /* â”€â”€ BADGE â”€â”€ */
  .badge{display:inline-flex;align-items:center;padding:3px 10px;border-radius:20px;font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:0.5px;}

  /* â”€â”€ INPUTS â”€â”€ */
  .input{width:100%;padding:10px 14px;background:var(--bg3);border:1px solid var(--border);border-radius:var(--radius-sm);color:var(--text);font-family:var(--font);font-size:14px;outline:none;transition:border var(--transition);}
  .input:focus{border-color:var(--accent);}
  .input::placeholder{color:var(--text3);}
  .select{appearance:none;cursor:pointer;}
  .form-group{display:flex;flex-direction:column;gap:6px;}
  .label{font-size:12px;font-weight:600;color:var(--text2);}

  /* â”€â”€ LOADING â”€â”€ */
  .spinner{width:36px;height:36px;border:3px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin 0.7s linear infinite;}
  .loading-overlay{position:fixed;inset:0;z-index:9998;display:flex;align-items:center;justify-content:center;background:rgba(15,15,19,0.8);backdrop-filter:blur(4px);}
  @keyframes spin{to{transform:rotate(360deg);}}

  /* â”€â”€ SPLASH â”€â”€ */
  .splash{position:fixed;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:24px;background:var(--bg);z-index:10000;}
  .splash-logo{font-size:64px;font-weight:800;color:var(--accent);letter-spacing:-4px;}
  .splash-sub{color:var(--text3);font-size:14px;}

  /* â”€â”€ CALENDAR â”€â”€ */
  .cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:4px;}
  .cal-day-name{text-align:center;font-size:11px;font-weight:700;color:var(--text3);padding:8px 0;text-transform:uppercase;letter-spacing:1px;}
  .cal-day{min-height:80px;padding:8px;border-radius:12px;background:var(--bg3);cursor:pointer;transition:all var(--transition);border:1px solid transparent;}
  .cal-day:hover{border-color:var(--accent-glow);}
  .cal-day.today{border-color:var(--accent);background:var(--accent-glow);}
  .cal-day.other-month{opacity:0.35;}
  .cal-day-num{font-size:13px;font-weight:600;color:var(--text2);}
  .cal-day.today .cal-day-num{color:var(--accent);}
  .cal-event-dot{width:100%;border-radius:3px;padding:2px 4px;font-size:10px;color:#fff;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;margin-top:3px;}
  .week-grid{display:grid;grid-template-columns:60px repeat(7,1fr);}
  .week-day-head{text-align:center;padding:12px 4px;font-size:12px;font-weight:600;color:var(--text2);border-bottom:1px solid var(--border);}
  .week-time-col{font-size:11px;color:var(--text3);font-family:var(--mono);padding-top:6px;text-align:right;padding-right:12px;}
  .week-slot{border-left:1px solid var(--border);border-bottom:1px solid rgba(255,255,255,0.03);height:40px;position:relative;cursor:pointer;}
  .week-slot:hover{background:var(--accent-glow);}
  .week-event{position:absolute;left:2px;right:2px;border-radius:6px;padding:2px 6px;font-size:11px;font-weight:600;color:#fff;overflow:hidden;cursor:pointer;z-index:2;white-space:nowrap;text-overflow:ellipsis;}

  /* â”€â”€ TASKS â”€â”€ */
  .task-item{display:flex;align-items:center;gap:12px;padding:14px 16px;border-radius:var(--radius-sm);background:var(--bg3);margin-bottom:8px;border:1px solid transparent;transition:border var(--transition);}
  .task-item:hover{border-color:var(--border);}
  .task-item.done{opacity:0.5;}
  .task-check{width:20px;height:20px;border-radius:6px;border:2px solid var(--border);flex-shrink:0;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all var(--transition);}
  .task-check.checked{background:var(--green);border-color:var(--green);}
  .task-title{flex:1;font-size:14px;font-weight:500;}
  .task-item.done .task-title{text-decoration:line-through;color:var(--text3);}
  .task-meta{display:flex;gap:8px;align-items:center;flex-wrap:wrap;}

  /* â”€â”€ HABITS â”€â”€ */
  .habit-item{display:flex;align-items:center;gap:12px;padding:16px;border-radius:var(--radius-sm);background:var(--bg3);margin-bottom:8px;}
  .habit-dot{width:28px;height:28px;border-radius:7px;background:var(--bg);border:1px solid var(--border);cursor:pointer;transition:all var(--transition);font-size:13px;display:flex;align-items:center;justify-content:center;}
  .habit-dot.done{background:var(--green);border-color:var(--green);color:#fff;}

  /* â”€â”€ STATS â”€â”€ */
  .stat-card{background:var(--bg2);border:1px solid var(--border);border-radius:var(--radius);padding:20px;display:flex;flex-direction:column;gap:8px;}
  .stat-num{font-size:36px;font-weight:800;font-family:var(--mono);letter-spacing:-2px;}
  .stat-label{font-size:12px;color:var(--text3);text-transform:uppercase;letter-spacing:1px;}
  .progress-bar{width:100%;height:6px;background:var(--bg3);border-radius:3px;overflow:hidden;}
  .progress-fill{height:100%;border-radius:3px;transition:width 0.6s cubic-bezier(.4,0,.2,1);}

  /* â”€â”€ MODAL â”€â”€ */
  .overlay{position:fixed;inset:0;z-index:999;background:rgba(0,0,0,0.7);backdrop-filter:blur(4px);display:flex;align-items:center;justify-content:center;}
  .modal{background:var(--bg2);border:1px solid var(--border);border-radius:20px;padding:28px;width:100%;max-width:480px;max-height:90vh;overflow-y:auto;box-shadow:0 24px 64px rgba(0,0,0,0.5);animation:slideUp 0.2s ease;}
  .modal-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:24px;}
  .modal-title{font-size:18px;font-weight:700;}
  @keyframes slideUp{from{transform:translateY(16px);opacity:0}to{transform:translateY(0);opacity:1}}

  /* â”€â”€ TABS â”€â”€ */
  .tabs{display:flex;gap:4px;background:var(--bg3);padding:4px;border-radius:12px;}
  .tab{flex:1;padding:8px 16px;border-radius:9px;border:none;background:none;color:var(--text2);font-family:var(--font);font-size:13px;font-weight:600;cursor:pointer;transition:all var(--transition);text-align:center;}
  .tab.active{background:var(--bg2);color:var(--text);box-shadow:var(--shadow);}

  .subject-chip{display:inline-flex;align-items:center;gap:6px;padding:6px 12px;border-radius:20px;font-size:13px;font-weight:600;border:1px solid var(--border);}

  /* â”€â”€ TOAST â”€â”€ */
  .toast{position:fixed;bottom:24px;right:24px;z-index:9999;background:var(--bg2);border:1px solid var(--border);border-radius:12px;padding:14px 20px;box-shadow:var(--shadow);font-size:14px;font-weight:500;animation:slideUp 0.2s ease;display:flex;align-items:center;gap:10px;max-width:320px;}

  ::-webkit-scrollbar{width:4px;height:4px;}
  ::-webkit-scrollbar-track{background:transparent;}
  ::-webkit-scrollbar-thumb{background:var(--border);border-radius:2px;}

  @media(max-width:768px){
    .nav{width:100%;height:64px;flex-direction:row;top:auto;bottom:0;padding:0 4px;border-right:none;border-top:1px solid var(--border);}
    .nav-logo{display:none;}
    .main{margin-left:0;margin-bottom:64px;padding:16px;}
    .grid-2,.grid-3,.grid-4{grid-template-columns:1fr;}
    .nav-item.active::before{display:none;}
    .nav-bottom{margin-top:0;flex-direction:row;}
  }
  @media(max-width:1024px){
    .grid-4{grid-template-columns:repeat(2,1fr);}
    .grid-3{grid-template-columns:1fr 1fr;}
  }

  .flex{display:flex;}.flex-col{flex-direction:column;}.items-center{align-items:center;}
  .justify-between{justify-content:space-between;}.gap-2{gap:8px;}.gap-3{gap:12px;}
  .w-full{width:100%;}.text-sm{font-size:13px;}.text-xs{font-size:11px;}
  .text-accent{color:var(--accent);}.text-muted{color:var(--text2);}
  .dot{width:8px;height:8px;border-radius:50%;display:inline-block;flex-shrink:0;}
  hr.divider{border:none;border-top:1px solid var(--border);margin:16px 0;}
</style>
</head>
<body>
<div id="root"></div>

<!-- React -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>

<!-- Firebase v10 (mÃ³dulos via CDN compat) -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

<script>
// â”€â”€â”€ FIREBASE CONFIG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const firebaseConfig = {
  apiKey: "AIzaSyB3ghd87bGn-Ovl4dTTqod4C3OK4PIc0fs",
  authDomain: "organizador-42dc3.firebaseapp.com",
  projectId: "organizador-42dc3",
  storageBucket: "organizador-42dc3.firebasestorage.app",
  messagingSenderId: "615484579948",
  appId: "1:615484579948:web:024befa3447c4af3d2f849"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db   = firebase.firestore();

// Helper: guardar datos del usuario en Firestore
const saveData = (uid, data) =>
  db.collection('users').doc(uid).set(data);

// Helper: leer datos del usuario
const loadData = async (uid) => {
  const snap = await db.collection('users').doc(uid).get();
  return snap.exists ? snap.data() : null;
};

// â”€â”€â”€ UTILS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const { useState, useEffect, useCallback, useRef } = React;

const DAYS   = ['Dom','Lun','Mar','MiÃ©','Jue','Vie','SÃ¡b'];
const MONTHS = ['Enero','Febrero','Marzo','Abril','Mayo','Junio','Julio','Agosto','Septiembre','Octubre','Noviembre','Diciembre'];
const COLORS = ['#7c6af7','#22d3ee','#4ade80','#fb923c','#f472b6','#facc15','#f87171','#a78bfa'];

const p2      = n  => String(n).padStart(2,'0');
const fmtDate = d  => `${d.getFullYear()}-${p2(d.getMonth()+1)}-${p2(d.getDate())}`;
const sameDay = (a,b) => fmtDate(new Date(a)) === fmtDate(new Date(b));
const todayStr = () => fmtDate(new Date());

const BLANK = () => ({
  theme:'dark', subjects:[], activities:[], tasks:[], habits:[], events:[], notes:[]
});

// Traduce errores de Firebase al espaÃ±ol
const firebaseError = (code) => {
  const map = {
    'auth/email-already-in-use':   'Ese email ya tiene una cuenta registrada.',
    'auth/invalid-email':          'El email no tiene un formato vÃ¡lido.',
    'auth/weak-password':          'La contraseÃ±a debe tener al menos 6 caracteres.',
    'auth/user-not-found':         'No existe una cuenta con ese email.',
    'auth/wrong-password':         'ContraseÃ±a incorrecta.',
    'auth/invalid-credential':     'Email o contraseÃ±a incorrectos.',
    'auth/too-many-requests':      'Demasiados intentos. EsperÃ¡ unos minutos.',
    'auth/network-request-failed': 'Sin conexiÃ³n. RevisÃ¡ tu internet.',
  };
  return map[code] || 'OcurriÃ³ un error. IntentÃ¡ de nuevo.';
};

// â”€â”€â”€ ICONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const IP = {
  home:'M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z M9 22V12h6v10',
  calendar:'M8 2v4m8-4v4M3 10h18M5 4h14a2 2 0 012 2v14a2 2 0 01-2 2H5a2 2 0 01-2-2V6a2 2 0 012-2z',
  book:'M4 19.5A2.5 2.5 0 016.5 17H20M4 19.5A2.5 2.5 0 014 17V4a2 2 0 012-2h12a2 2 0 012 2v13.5',
  activity:'M22 12h-4l-3 9L9 3l-3 9H2',
  check:'M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z',
  heart:'M20.84 4.61a5.5 5.5 0 00-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 00-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 000-7.78z',
  chart:'M18 20V10M12 20V4M6 20v-6',
  focus:'M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z',
  note:'M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z',
  sun:'M12 1v2m0 18v2M4.22 4.22l1.42 1.42m10.72 10.72l1.42 1.42M1 12h2m18 0h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42M12 5a7 7 0 000 14A7 7 0 0012 5z',
  moon:'M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z',
  plus:'M12 5v14M5 12h14', x:'M18 6L6 18M6 6l12 12',
  trash:'M3 6h18M8 6V4h8v2M19 6l-1 14H6L5 6',
  logout:'M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4M16 17l5-5-5-5M21 12H9',
  chevR:'M9 18l6-6-6-6', chevL:'M15 18l-6-6 6-6',
  user:'M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2M12 11a4 4 0 100-8 4 4 0 000 8z',
};
const Icon = ({name,size=18}) =>
  React.createElement('svg',{width:size,height:size,viewBox:'0 0 24 24',fill:'none',stroke:'currentColor',strokeWidth:2,strokeLinecap:'round',strokeLinejoin:'round'},
    ...(IP[name]||'').split('M').filter(Boolean).map((p,i)=>React.createElement('path',{key:i,d:'M'+p}))
  );

// â”€â”€â”€ SHARED UI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const Modal = ({title,onClose,children}) =>
  React.createElement('div',{className:'overlay',onClick:e=>e.target.className==='overlay'&&onClose()},
    React.createElement('div',{className:'modal'},
      React.createElement('div',{className:'modal-header'},
        React.createElement('div',{className:'modal-title'},title),
        React.createElement('button',{className:'btn btn-ghost btn-icon',onClick:onClose},React.createElement(Icon,{name:'x',size:16}))
      ),children
    )
  );

function Toast({msg,type='success',onDone}) {
  useEffect(()=>{const t=setTimeout(onDone,3200);return()=>clearTimeout(t);},[]);
  const e=type==='error'?'âŒ':type==='info'?'â„¹ï¸':'âœ…';
  return React.createElement('div',{className:'toast'},e,' ',msg);
}

const ColorPicker = ({value,onChange}) =>
  React.createElement('div',{className:'flex gap-2',style:{flexWrap:'wrap'}},
    COLORS.map(c=>React.createElement('div',{key:c,onClick:()=>onChange(c),
      style:{width:28,height:28,borderRadius:'50%',background:c,cursor:'pointer',
             border:value===c?'3px solid white':'3px solid transparent',transition:'border 0.15s'}}))
  );

const DayToggle = ({options,value,onChange}) =>
  React.createElement('div',{className:'flex gap-2',style:{flexWrap:'wrap'}},
    options.map(d=>React.createElement('button',{key:d,
      className:`btn btn-sm ${value.includes(d)?'btn-primary':'btn-ghost'}`,
      onClick:()=>onChange(value.includes(d)?value.filter(x=>x!==d):[...value,d])},d))
  );

// â”€â”€â”€ AUTH PAGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function AuthPage({onAuth}) {
  const [tab,setTab]   = useState('login');
  const [form,setForm] = useState({email:'',password:'',name:''});
  const [error,setError]   = useState('');
  const [loading,setLoading] = useState(false);

  const handle = async () => {
    setError(''); setLoading(true);
    try {
      let cred;
      if(tab==='login') {
        cred = await auth.signInWithEmailAndPassword(form.email, form.password);
      } else {
        if(!form.name.trim()){ setError('IngresÃ¡ tu nombre.'); setLoading(false); return; }
        cred = await auth.createUserWithEmailAndPassword(form.email, form.password);
        await cred.user.updateProfile({ displayName: form.name.trim() });
      }
      onAuth(cred.user);
    } catch(e) {
      setError(firebaseError(e.code));
    }
    setLoading(false);
  };

  const F  = k => e => setForm(p=>({...p,[k]:e.target.value}));
  const ok = e => e.key==='Enter' && handle();
  const can = form.email.trim() && form.password.trim() && !loading;

  return React.createElement('div',{className:'auth-page'},
    React.createElement('div',{className:'auth-glow',style:{top:'-200px',left:'-200px'}}),
    React.createElement('div',{className:'auth-glow',style:{bottom:'-200px',right:'-200px'}}),
    React.createElement('div',{className:'auth-card'},
      React.createElement('div',{className:'auth-logo'},'Orbi'),
      React.createElement('div',{className:'auth-tagline'},'Tu organizador personal y acadÃ©mico'),

      React.createElement('div',{className:'auth-tabs'},
        React.createElement('button',{className:`auth-tab${tab==='login'?' active':''}`,onClick:()=>{setTab('login');setError('');}}, 'Iniciar SesiÃ³n'),
        React.createElement('button',{className:`auth-tab${tab==='register'?' active':''}`,onClick:()=>{setTab('register');setError('');}}, 'Registrarse')
      ),

      error && React.createElement('div',{className:'auth-error'},error),

      React.createElement('div',{className:'flex flex-col gap-3'},
        tab==='register' && React.createElement('div',{className:'form-group'},
          React.createElement('label',{className:'label'},'Nombre completo'),
          React.createElement('input',{className:'input',placeholder:'Tu nombre',value:form.name,onChange:F('name'),onKeyDown:ok})
        ),
        React.createElement('div',{className:'form-group'},
          React.createElement('label',{className:'label'},'Email'),
          React.createElement('input',{className:'input',type:'email',placeholder:'tu@email.com',value:form.email,onChange:F('email'),onKeyDown:ok,autoComplete:'email'})
        ),
        React.createElement('div',{className:'form-group'},
          React.createElement('label',{className:'label'},'ContraseÃ±a'+(tab==='register'?' (mÃ­n. 6 caracteres)':'')),
          React.createElement('input',{className:'input',type:'password',placeholder:'â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢',value:form.password,onChange:F('password'),onKeyDown:ok,autoComplete:tab==='login'?'current-password':'new-password'})
        ),
        React.createElement('button',{
          className:'btn btn-primary w-full',
          style:{justifyContent:'center',marginTop:8},
          onClick:handle,disabled:!can
        }, loading
          ? React.createElement('div',{className:'spinner',style:{width:20,height:20,borderWidth:2}})
          : (tab==='login'?'Entrar â†’':'Crear cuenta â†’')
        )
      ),

      React.createElement('div',{style:{textAlign:'center',marginTop:20,fontSize:12,color:'var(--text3)'}},
        tab==='login'
          ? React.createElement('span',null,'Â¿Sin cuenta? ',React.createElement('span',{style:{color:'var(--accent)',cursor:'pointer',fontWeight:600},onClick:()=>{setTab('register');setError('');}}, 'Registrate gratis'))
          : React.createElement('span',null,'Â¿Ya tenÃ©s cuenta? ',React.createElement('span',{style:{color:'var(--accent)',cursor:'pointer',fontWeight:600},onClick:()=>{setTab('login');setError('');}}, 'IniciÃ¡ sesiÃ³n'))
      ),

      React.createElement('div',{style:{marginTop:20,padding:12,background:'var(--bg3)',borderRadius:10,fontSize:11,color:'var(--text3)',textAlign:'center',lineHeight:1.5}},
        'ðŸ”’ AutenticaciÃ³n segura con Firebase Â· Datos privados por usuario'
      )
    )
  );
}

// â”€â”€â”€ DASHBOARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function Dashboard({state,setPage,user}) {
  const now     = new Date();
  const todayEvs= state.events.filter(e=>sameDay(e.date,now));
  const doneT   = state.tasks.filter(t=>t.status==='completada').length;
  const pendT   = state.tasks.filter(t=>t.status!=='completada').length;
  const habPct  = Math.round(state.habits.reduce((a,h)=>a+Math.min(h.done.length,7),0)/Math.max(state.habits.length*7,1)*100);
  const name    = (user.displayName||user.email||'').split(' ')[0].split('@')[0];
  const h       = now.getHours();
  const greet   = h<12?`Buenos dÃ­as, ${name} â˜€ï¸`:h<19?`Buenas tardes, ${name} ðŸŒ¤ï¸`:`Buenas noches, ${name} ðŸŒ™`;

  const SC=(label,value,sub,color)=>React.createElement('div',{className:'stat-card'},
    React.createElement('div',{className:'stat-num',style:{color}},value),
    React.createElement('div',{className:'stat-label'},label),
    React.createElement('div',{style:{fontSize:11,color:'var(--text3)'}},sub)
  );

  return React.createElement('div',null,
    React.createElement('div',{className:'page-header'},
      React.createElement('div',null,
        React.createElement('div',{className:'text-sm text-muted'},greet),
        React.createElement('h1',{className:'page-title'},'Mi ',React.createElement('span',null,'Panel'))
      ),
      React.createElement('button',{className:'btn btn-primary',onClick:()=>setPage('calendar')},React.createElement(Icon,{name:'plus',size:16}),'Nuevo Evento')
    ),
    React.createElement('div',{className:'grid-4'},
      SC('Eventos Hoy',todayEvs.length,'programados','#7c6af7'),
      SC('Pendientes',pendT,'tareas','#fb923c'),
      SC('Completadas',doneT,'tareas','#4ade80'),
      SC('HÃ¡bitos',habPct+'%','semanal','#22d3ee')
    ),
    React.createElement('div',{className:'grid-2',style:{gap:20}},
      React.createElement('div',{className:'card'},
        React.createElement('div',{className:'card-title'},'ðŸ“… Eventos de Hoy'),
        todayEvs.length===0
          ? React.createElement('p',{className:'text-sm text-muted'},'Sin eventos para hoy ðŸŽ‰')
          : todayEvs.map(ev=>React.createElement('div',{key:ev.id,className:'task-item',style:{borderLeft:`3px solid ${ev.color}`}},
              React.createElement('div',{className:'dot',style:{background:ev.color}}),
              React.createElement('div',null,
                React.createElement('div',{style:{fontWeight:600,fontSize:14}},ev.title),
                React.createElement('div',{className:'text-xs text-muted'},ev.start,' - ',ev.end)
              )
            ))
      ),
      React.createElement('div',{className:'card'},
        React.createElement('div',{className:'card-title'},'ðŸ”¥ Tareas Urgentes'),
        state.tasks.filter(t=>t.priority==='alta'&&t.status!=='completada').slice(0,4).map(t=>
          React.createElement('div',{key:t.id,className:'task-item'},
            React.createElement('div',{className:'dot',style:{background:'var(--red)'}}),
            React.createElement('div',null,
              React.createElement('div',{style:{fontWeight:600,fontSize:14}},t.title),
              React.createElement('div',{className:'text-xs text-muted'},'Vence: ',t.dueDate||'Sin fecha')
            )
          )
        ),
        state.tasks.filter(t=>t.priority==='alta'&&t.status!=='completada').length===0&&
          React.createElement('p',{className:'text-sm text-muted'},'Sin urgentes âœ…')
      )
    ),
    React.createElement('div',{className:'grid-2',style:{gap:20}},
      React.createElement('div',{className:'card'},
        React.createElement('div',{className:'card-title'},'ðŸ“š Materias'),
        state.subjects.length===0
          ? React.createElement('p',{className:'text-sm text-muted',style:{cursor:'pointer',color:'var(--accent)'},onClick:()=>setPage('faculty')},'+ Agregar materias')
          : React.createElement('div',{className:'flex',style:{flexWrap:'wrap',gap:8}},
              state.subjects.map(s=>React.createElement('div',{key:s.id,className:'subject-chip',style:{borderColor:s.color+'44',color:s.color}},
                React.createElement('div',{style:{width:6,height:6,borderRadius:'50%',background:s.color}}),s.name
              ))
            )
      ),
      React.createElement('div',{className:'card'},
        React.createElement('div',{className:'card-title'},'ðŸ’š HÃ¡bitos Semanales'),
        state.habits.length===0
          ? React.createElement('p',{className:'text-sm text-muted',style:{cursor:'pointer',color:'var(--accent)'},onClick:()=>setPage('habits')},'+ Agregar hÃ¡bitos')
          : state.habits.slice(0,4).map(h=>{
              const pct=Math.min(h.done.length/7*100,100);
              return React.createElement('div',{key:h.id,style:{marginBottom:10}},
                React.createElement('div',{className:'flex justify-between',style:{marginBottom:4}},
                  React.createElement('span',{className:'text-sm'},h.icon,' ',h.name),
                  React.createElement('span',{className:'text-xs text-muted'},h.streak,' ðŸ”¥')
                ),
                React.createElement('div',{className:'progress-bar'},
                  React.createElement('div',{className:'progress-fill',style:{width:pct+'%',background:pct>60?'var(--green)':pct>30?'var(--yellow)':'var(--red)'}})
                )
              );
            })
      )
    )
  );
}

// â”€â”€â”€ CALENDAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

// Helper: parse a subject's time string like "08:00-10:00" into {start, end}
function parseSubjectTime(timeStr) {
  if(!timeStr) return null;
  const m = timeStr.match(/(\d{1,2}):(\d{2})\s*[-â€“]\s*(\d{1,2}):(\d{2})/);
  if(!m) return null;
  return { startH: parseInt(m[1]), startM: parseInt(m[2]), endH: parseInt(m[3]), endM: parseInt(m[4]) };
}

// Map short day labels to indices (Dom=0, Lun=1, ... SÃ¡b=6)
const DAY_IDX = {'Dom':0,'Lun':1,'Mar':2,'MiÃ©':3,'Jue':4,'Vie':5,'SÃ¡b':6};

function FixedWeekCalendar({subjects, events}) {
  // Show hours 7-22 for compactness
  const START_H = 7, END_H = 22;
  const hours = Array.from({length: END_H - START_H}, (_, i) => START_H + i);
  // Days Mon-Sat (1-6 index), or Mon-Sun depends on subjects
  const weekDays = ['Lun','Mar','MiÃ©','Jue','Vie','SÃ¡b'];
  const weekDayIdx = [1,2,3,4,5,6];

  // Today's day index
  const todayDayIdx = new Date().getDay();

  // Get current week dates for showing events
  const now = new Date();
  const weekStart = new Date(now);
  weekStart.setDate(now.getDate() - now.getDay()); // Sunday
  const weekDates = weekDayIdx.map(i => {
    const d = new Date(weekStart);
    d.setDate(weekStart.getDate() + i);
    return fmtDate(d);
  });

  const slotH = 44; // px per hour slot

  return React.createElement('div',{style:{overflowX:'auto'}},
    React.createElement('div',{style:{display:'grid',gridTemplateColumns:`52px repeat(${weekDays.length},1fr)`,minWidth:520}},
      // Header row
      React.createElement('div',{style:{padding:'8px 0'}}),
      weekDays.map((d,i)=>React.createElement('div',{key:d,style:{
        textAlign:'center',padding:'10px 4px',fontSize:12,fontWeight:700,
        color: weekDayIdx[i]===todayDayIdx?'var(--accent)':'var(--text2)',
        borderBottom:'2px solid var(--border)',
        background: weekDayIdx[i]===todayDayIdx?'var(--accent-glow)':'transparent',
        borderRadius: weekDayIdx[i]===todayDayIdx?'8px 8px 0 0':'0',
        textTransform:'uppercase',letterSpacing:'0.5px'
      }},d)),

      // Time slots
      hours.map(h=>React.createElement(React.Fragment,{key:h},
        React.createElement('div',{style:{
          fontSize:10,color:'var(--text3)',fontFamily:'var(--mono)',
          paddingRight:8,paddingTop:6,textAlign:'right',
          height:slotH,borderTop:'1px solid var(--border)'
        }},`${p2(h)}:00`),
        weekDays.map((d,di)=>{
          const dayI = weekDayIdx[di];
          // Find subjects that run on this day and overlap this hour
          const subjectsHere = subjects.filter(sub=>{
            if(!(sub.days||[]).some(sd=>DAY_IDX[sd]===dayI)) return false;
            const t = parseSubjectTime(sub.time);
            if(!t) return false;
            return t.startH === h || (t.startH < h && t.endH > h);
          });
          // Only render at the start hour to avoid duplicates
          const subjectsStart = subjects.filter(sub=>{
            if(!(sub.days||[]).some(sd=>DAY_IDX[sd]===dayI)) return false;
            const t = parseSubjectTime(sub.time);
            return t && t.startH === h;
          });
          // Events for this weekday date
          const dateStr = weekDates[di];
          const eventsHere = events.filter(e=>e.date===dateStr && Number((e.start||'0').split(':')[0])===h);

          return React.createElement('div',{key:d,style:{
            borderLeft:'1px solid var(--border)',
            borderTop:'1px solid var(--border)',
            height:slotH,
            position:'relative',
            background: dayI===todayDayIdx?'rgba(124,106,247,0.03)':'transparent'
          }},
            subjectsStart.map(sub=>{
              const t = parseSubjectTime(sub.time);
              if(!t) return null;
              const durH = (t.endH + t.endM/60) - (t.startH + t.startM/60);
              const topOff = (t.startM/60)*slotH;
              return React.createElement('div',{key:sub.id,style:{
                position:'absolute',left:2,right:2,
                top: topOff,
                height: Math.max(durH*slotH - 2, 20),
                background: sub.color,
                borderRadius:6,
                padding:'3px 6px',
                fontSize:10,
                fontWeight:700,
                color:'#fff',
                overflow:'hidden',
                zIndex:2,
                boxShadow:'0 2px 8px rgba(0,0,0,0.3)',
                lineHeight:1.3
              }},
                React.createElement('div',{style:{whiteSpace:'nowrap',overflow:'hidden',textOverflow:'ellipsis'}},sub.name),
                sub.room&&React.createElement('div',{style:{opacity:0.8,fontSize:9}},sub.room)
              );
            }),
            eventsHere.map(ev=>React.createElement('div',{key:ev.id,style:{
              position:'absolute',left:2,right:2,top:2,
              background:ev.color+'cc',
              borderRadius:5,
              padding:'2px 5px',
              fontSize:10,
              fontWeight:600,
              color:'#fff',
              overflow:'hidden',
              zIndex:3,
              border:`1px solid ${ev.color}`
            }},ev.title))
          );
        })
      ))
    )
  );
}

function Calendar({state,setState,showToast}) {
  const [view,setView]=useState('month');
  const [curr,setCurr]=useState(new Date());
  const [modal,setModal]=useState(false);
  const [editEv,setEditEv]=useState(null);
  const blank={title:'',category:'facultad',subject:'',start:'09:00',end:'10:00',color:'#7c6af7',date:todayStr()};
  const [form,setForm]=useState(blank);

  const nav=dir=>{const d=new Date(curr);if(view==='month')d.setMonth(d.getMonth()+dir);else if(view==='week')d.setDate(d.getDate()+dir*7);else d.setDate(d.getDate()+dir);setCurr(d);};
  const lbl=()=>{if(view==='month')return `${MONTHS[curr.getMonth()]} ${curr.getFullYear()}`;if(view==='week'){const s=new Date(curr);s.setDate(s.getDate()-s.getDay());const e=new Date(s);e.setDate(e.getDate()+6);return `${s.getDate()} - ${e.getDate()} ${MONTHS[s.getMonth()]}`;}return `${curr.getDate()} de ${MONTHS[curr.getMonth()]}`;};
  const openNew=date=>{setEditEv(null);setForm({...blank,date:date||todayStr()});setModal(true);};
  const openEdit=ev=>{setEditEv(ev);setForm({...ev});setModal(true);};
  const save=()=>{
    if(!form.title.trim()) return;
    const ev={...form,id:editEv?editEv.id:Date.now()};
    setState(s=>({...s,events:editEv?s.events.map(e=>e.id===editEv.id?ev:e):[...s.events,ev]}));
    setModal(false);showToast(editEv?'Evento actualizado':'Evento creado');
  };
  const del=id=>{setState(s=>({...s,events:s.events.filter(e=>e.id!==id)}));setModal(false);showToast('Evento eliminado');};
  const F=k=>e=>setForm(f=>({...f,[k]:e.target.value}));

  return React.createElement('div',{style:{display:'flex',flexDirection:'column',gap:24}},
    React.createElement('div',{className:'page-header'},
      React.createElement('h1',{className:'page-title'},'ðŸ“… ',React.createElement('span',null,'Calendario')),
      React.createElement('button',{className:'btn btn-primary',onClick:()=>openNew()},React.createElement(Icon,{name:'plus',size:16}),'Agregar Evento')
    ),

    // â”€â”€ SECCIÃ“N 1: Horario Semanal Fijo â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    React.createElement('div',{className:'card'},
      React.createElement('div',{style:{display:'flex',alignItems:'center',justifyContent:'space-between',marginBottom:16}},
        React.createElement('div',null,
          React.createElement('div',{className:'card-title',style:{marginBottom:2}},'ðŸ“š Horario Semanal â€” Esta Semana'),
          state.subjects.length===0&&React.createElement('div',{style:{fontSize:12,color:'var(--text3)'}},
            'AgregÃ¡ materias en la secciÃ³n Facultad para verlas aquÃ­'
          )
        ),
        state.subjects.length>0&&React.createElement('div',{style:{display:'flex',flexWrap:'wrap',gap:6}},
          state.subjects.map(s=>React.createElement('span',{key:s.id,style:{
            display:'inline-flex',alignItems:'center',gap:4,
            padding:'3px 10px',borderRadius:20,fontSize:11,fontWeight:600,
            background:s.color+'22',color:s.color,border:`1px solid ${s.color}44`
          }},React.createElement('span',{style:{width:6,height:6,borderRadius:'50%',background:s.color,display:'inline-block'}}),s.name))
        )
      ),
      React.createElement(FixedWeekCalendar,{subjects:state.subjects,events:state.events})
    ),

    // â”€â”€ SECCIÃ“N 2: Calendario DinÃ¡mico â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    React.createElement('div',{className:'card'},
      React.createElement('div',{style:{display:'flex',alignItems:'center',marginBottom:20,flexWrap:'wrap',gap:12}},
        React.createElement('div',{className:'card-title',style:{marginBottom:0,marginRight:8}},'ðŸ—“ Vista Detallada'),
        React.createElement('div',{className:'tabs',style:{maxWidth:260}},
          [['month','Mes'],['week','Semana'],['day','DÃ­a']].map(([v,l])=>React.createElement('button',{key:v,className:`tab${view===v?' active':''}`,onClick:()=>setView(v)},l))
        ),
        React.createElement('div',{className:'flex items-center gap-2',style:{marginLeft:'auto'}},
          React.createElement('button',{className:'btn btn-ghost btn-icon btn-sm',onClick:()=>nav(-1)},React.createElement(Icon,{name:'chevL',size:16})),
          React.createElement('span',{style:{fontWeight:700,minWidth:180,textAlign:'center',fontSize:14}},lbl()),
          React.createElement('button',{className:'btn btn-ghost btn-icon btn-sm',onClick:()=>nav(1)},React.createElement(Icon,{name:'chevR',size:16})),
          React.createElement('button',{className:'btn btn-ghost btn-sm',onClick:()=>setCurr(new Date())},'Hoy')
        )
      ),
      view==='month'&&React.createElement(MonthView,{curr,events:state.events,subjects:state.subjects,onDay:openNew,onEvent:openEdit}),
      view==='week'&&React.createElement(WeekView,{curr,events:state.events,subjects:state.subjects,onEvent:openEdit}),
      view==='day'&&React.createElement(DayView,{curr,events:state.events,subjects:state.subjects,onEvent:openEdit}),
    ),

    modal&&React.createElement(Modal,{title:editEv?'Editar Evento':'Nuevo Evento',onClose:()=>setModal(false)},
      React.createElement('div',{className:'flex flex-col gap-3'},
        React.createElement('div',{className:'form-group'},React.createElement('label',{className:'label'},'TÃ­tulo'),React.createElement('input',{className:'input',value:form.title,placeholder:'Ej: Parcial CÃ¡lculo',onChange:F('title')})),
        React.createElement('div',{className:'form-group'},React.createElement('label',{className:'label'},'CategorÃ­a'),React.createElement('select',{className:'input select',value:form.category,onChange:F('category')},['facultad','extracurricular','personal','hogar'].map(c=>React.createElement('option',{key:c,value:c},c)))),
        state.subjects.length>0&&form.category==='facultad'&&React.createElement('div',{className:'form-group'},
          React.createElement('label',{className:'label'},'Materia'),
          React.createElement('select',{className:'input select',value:form.subject,onChange:F('subject')},
            React.createElement('option',{value:''},'â€” Sin materia â€”'),
            state.subjects.map(s=>React.createElement('option',{key:s.id,value:s.name},s.name))
          )
        ),
        React.createElement('div',{className:'grid-2',style:{gap:12}},
          React.createElement('div',{className:'form-group'},React.createElement('label',{className:'label'},'Inicio'),React.createElement('input',{className:'input',type:'time',value:form.start,onChange:F('start')})),
          React.createElement('div',{className:'form-group'},React.createElement('label',{className:'label'},'Fin'),React.createElement('input',{className:'input',type:'time',value:form.end,onChange:F('end')}))
        ),
        React.createElement('div',{className:'form-group'},React.createElement('label',{className:'label'},'Fecha'),React.createElement('input',{className:'input',type:'date',value:form.date,onChange:F('date')})),
        React.createElement('div',{className:'form-group'},React.createElement('label',{className:'label'},'Color'),
          state.subjects.length>0&&form.subject
            ? React.createElement('div',{style:{fontSize:12,color:'var(--text2)'}},
                'Color de la materia: ',
                React.createElement('span',{style:{color:state.subjects.find(s=>s.name===form.subject)?.color||'var(--accent)',fontWeight:700}},
                  state.subjects.find(s=>s.name===form.subject)?.color||form.color
                ),
                ' (automÃ¡tico)'
              )
            : React.createElement(ColorPicker,{value:form.color,onChange:c=>setForm(f=>({...f,color:c}))})
        ),
        React.createElement('div',{className:'flex gap-2',style:{marginTop:8}},
          React.createElement('button',{className:'btn btn-primary',style:{flex:1,justifyContent:'center'},onClick:()=>{
            // Auto-use subject color if subject is selected
            const sub = state.subjects.find(s=>s.name===form.subject);
            if(sub) setForm(f=>({...f,color:sub.color}));
            save();
          }},'Guardar'),
          editEv&&React.createElement('button',{className:'btn btn-danger',onClick:()=>del(editEv.id)},React.createElement(Icon,{name:'trash',size:16}))
        )
      )
    )
  );
}

function MonthView({curr,events,subjects,onDay,onEvent}) {
  const yr=curr.getFullYear(),mo=curr.getMonth();
  const fd=new Date(yr,mo,1).getDay(),dim=new Date(yr,mo+1,0).getDate(),prev=new Date(yr,mo,0).getDate();
  const ts=todayStr(),cells=[];
  for(let i=fd-1;i>=0;i--)cells.push({day:prev-i,curr:false,date:`${yr}-${p2(mo)}-${p2(prev-i)}`});
  for(let d=1;d<=dim;d++)cells.push({day:d,curr:true,date:`${yr}-${p2(mo+1)}-${p2(d)}`});
  while(cells.length%7!==0){const nx=cells.length-fd-dim+1;cells.push({day:nx,curr:false,date:`${yr}-${p2(mo+2)}-${p2(nx)}`});}
  return React.createElement('div',null,
    React.createElement('div',{className:'cal-grid'},
      DAYS.map(d=>React.createElement('div',{key:d,className:'cal-day-name'},d)),
      cells.map((c,i)=>{
        const evs=events.filter(e=>e.date===c.date);
        const cellDate = new Date(c.date+'T12:00:00');
        const dayOfWeek = cellDate.getDay();
        // Subject indicators for this day of week
        const subs = subjects.filter(s=>(s.days||[]).some(sd=>DAY_IDX[sd]===dayOfWeek));
        return React.createElement('div',{key:i,className:`cal-day${!c.curr?' other-month':''}${c.date===ts?' today':''}`,onClick:()=>onDay(c.date)},
          React.createElement('div',{className:'cal-day-num'},c.day),
          subs.slice(0,1).map(sub=>React.createElement('div',{key:sub.id,className:'cal-event-dot',style:{background:sub.color+'88',fontSize:9}},
            'ðŸ“š ',sub.name
          )),
          evs.slice(0,2).map(ev=>React.createElement('div',{key:ev.id,className:'cal-event-dot',style:{background:ev.color},onClick:e=>{e.stopPropagation();onEvent(ev);}},ev.title)),
          (evs.length+subs.length)>3&&React.createElement('div',{style:{fontSize:10,color:'var(--text3)',marginTop:2}},'+',evs.length+subs.length-3,' mÃ¡s')
        );
      })
    )
  );
}

function WeekView({curr,events,subjects,onEvent}) {
  const s=new Date(curr);s.setDate(s.getDate()-s.getDay());
  const days=Array.from({length:7},(_,i)=>{const d=new Date(s);d.setDate(d.getDate()+i);return d;});
  const ts=todayStr();
  const START_H=7, END_H=22;
  return React.createElement('div',{style:{overflowX:'auto'}},
    React.createElement('div',{className:'week-grid',style:{minWidth:600}},
      React.createElement('div',{style:{paddingTop:40}}),
      days.map(d=>React.createElement('div',{key:+d,className:'week-day-head',style:{color:fmtDate(d)===ts?'var(--accent)':'',fontWeight:fmtDate(d)===ts?700:600}},DAYS[d.getDay()]+' '+d.getDate())),
      Array.from({length:END_H-START_H},(_,hi)=>{const h=START_H+hi;return React.createElement(React.Fragment,{key:h},
        React.createElement('div',{className:'week-time-col'},`${p2(h)}:00`),
        days.map(d=>{
          const ds=fmtDate(d);
          const dayI=d.getDay();
          const evs=events.filter(e=>e.date===ds&&Number((e.start||'0').split(':')[0])===h);
          const subs=subjects.filter(sub=>{
            if(!(sub.days||[]).some(sd=>DAY_IDX[sd]===dayI)) return false;
            const t=parseSubjectTime(sub.time);
            return t&&t.startH===h;
          });
          return React.createElement('div',{key:+d,className:'week-slot'},
            subs.map(sub=>{
              const t=parseSubjectTime(sub.time);
              const durH=(t.endH+t.endM/60)-(t.startH+t.startM/60);
              return React.createElement('div',{key:sub.id,className:'week-event',style:{
                background:sub.color,top:0,height:Math.max(durH*40-2,20),
                border:`1px solid ${sub.color}`,fontSize:10,opacity:0.9
              }},'ðŸ“š '+sub.name);
            }),
            evs.map(ev=>React.createElement('div',{key:ev.id,className:'week-event',style:{background:ev.color,top:0,height:36},onClick:e=>{e.stopPropagation();onEvent(ev);}},ev.title))
          );
        })
      )})
    )
  );
}

function DayView({curr,events,subjects,onEvent}) {
  const ds=fmtDate(curr);
  const dayEvs=events.filter(e=>e.date===ds);
  const dayI=curr.getDay();
  const START_H=7,END_H=22;
  return React.createElement('div',{style:{overflowY:'auto',maxHeight:'60vh'}},
    React.createElement('div',{className:'week-grid',style:{gridTemplateColumns:'60px 1fr'}},
      React.createElement('div'),
      React.createElement('div',{className:'week-day-head'},DAYS[curr.getDay()]+' '+curr.getDate()+' de '+MONTHS[curr.getMonth()]),
      Array.from({length:END_H-START_H},(_,hi)=>{const h=START_H+hi;return React.createElement(React.Fragment,{key:h},
        React.createElement('div',{className:'week-time-col'},`${p2(h)}:00`),
        React.createElement('div',{className:'week-slot'},
          subjects.filter(sub=>{
            if(!(sub.days||[]).some(sd=>DAY_IDX[sd]===dayI)) return false;
            const t=parseSubjectTime(sub.time);return t&&t.startH===h;
          }).map(sub=>{
            const t=parseSubjectTime(sub.time);
            const durH=(t.endH+t.endM/60)-(t.startH+t.startM/60);
            return React.createElement('div',{key:sub.id,className:'week-event',style:{background:sub.color,height:Math.max(durH*40-2,20),top:0,fontSize:10}},'ðŸ“š '+sub.name+(sub.room?' Â· '+sub.room:''));
          }),
          dayEvs.filter(e=>Number((e.start||'0').split(':')[0])===h).map(ev=>React.createElement('div',{key:ev.id,className:'week-event',style:{background:ev.color},onClick:e=>{e.stopPropagation();onEvent(ev);}},ev.title+' '+ev.start+'-'+ev.end))
        )
      )})
    )
  );
}

// â”€â”€â”€ FACULTY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function Faculty({state,setState,showToast}) {
  const [modal,setModal]=useState(false);
  const [form,setForm]=useState({name:'',color:COLORS[0],days:[],time:'',room:''});
  const save=()=>{
    if(!form.name.trim()) return;
    setState(s=>({...s,subjects:[...s.subjects,{...form,id:Date.now()}]}));
    setModal(false);setForm({name:'',color:COLORS[0],days:[],time:'',room:''});showToast('Materia agregada');
  };
  const del=id=>{setState(s=>({...s,subjects:s.subjects.filter(x=>x.id!==id)}));showToast('Materia eliminada');};
  return React.createElement('div',null,
    React.createElement('div',{className:'page-header'},
      React.createElement('h1',{className:'page-title'},'ðŸŽ“ ',React.createElement('span',null,'Facultad')),
      React.createElement('button',{className:'btn btn-primary',onClick:()=>setModal(true)},React.createElement(Icon,{name:'plus',size:16}),'Materia')
    ),
    state.subjects.length===0&&React.createElement('div',{className:'card',style:{textAlign:'center',padding:40,color:'var(--text3)'}},'TodavÃ­a no cargaste materias. Â¡EmpezÃ¡ ahora!'),
    React.createElement('div',{className:'grid-2'},
      state.subjects.map(s=>React.createElement('div',{key:s.id,className:'card',style:{borderLeft:`4px solid ${s.color}`}},
        React.createElement('div',{className:'flex justify-between items-center'},
          React.createElement('div',null,
            React.createElement('div',{style:{fontSize:16,fontWeight:700,color:s.color}},s.name),
            React.createElement('div',{className:'text-sm text-muted',style:{marginTop:4}},(s.days||[]).join(', ')||'Sin dÃ­as',' â€¢ ',s.time||'Sin horario'),
            s.room&&React.createElement('div',{className:'text-xs text-muted',style:{marginTop:2}},'ðŸ“ ',s.room)
          ),
          React.createElement('button',{className:'btn btn-ghost btn-icon btn-sm',style:{color:'var(--text3)'},onClick:()=>del(s.id)},React.createElement(Icon,{name:'trash',size:14}))
        )
      ))
    ),
    modal&&React.createElement(Modal,{title:'Nueva Materia',onClose:()=>setModal(false)},
      React.createElement('div',{className:'flex flex-col gap-3'},
        React.createElement('div',{className:'form-group'},React.createElement('label',{className:'label'},'Nombre'),React.createElement('input',{className:'input',placeholder:'Ej: CÃ¡lculo II',value:form.name,onChange:e=>setForm(f=>({...f,name:e.target.value}))})),
        React.createElement('div',{className:'form-group'},React.createElement('label',{className:'label'},'DÃ­as'),React.createElement(DayToggle,{options:['Lun','Mar','MiÃ©','Jue','Vie','SÃ¡b'],value:form.days,onChange:v=>setForm(f=>({...f,days:v}))})),
        React.createElement('div',{className:'form-group'},React.createElement('label',{className:'label'},'Horario'),React.createElement('input',{className:'input',placeholder:'08:00-10:00',value:form.time,onChange:e=>setForm(f=>({...f,time:e.target.value}))})),
        React.createElement('div',{className:'form-group'},React.createElement('label',{className:'label'},'Aula / Modalidad'),React.createElement('input',{className:'input',placeholder:'Aula 12 / Virtual',value:form.room,onChange:e=>setForm(f=>({...f,room:e.target.value}))})),
        React.createElement('div',{className:'form-group'},React.createElement('label',{className:'label'},'Color'),React.createElement(ColorPicker,{value:form.color,onChange:c=>setForm(f=>({...f,color:c}))})),
        React.createElement('button',{className:'btn btn-primary w-full',style:{justifyContent:'center'},onClick:save},'Guardar Materia')
      )
    )
  );
}

// â”€â”€â”€ ACTIVITIES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function Activities({state,setState,showToast}) {
  const [modal,setModal]=useState(false);
  const [form,setForm]=useState({name:'',icon:'ðŸŽ¯',color:COLORS[2],days:[],time:''});
  const ICONS=['ðŸ‹ï¸','ðŸƒ','ðŸ§˜','ðŸ“š','ðŸŽ¸','ðŸŽ¨','âš½','ðŸŠ','ðŸš´','ðŸŽ®','ðŸ³','âœï¸'];
  const save=()=>{
    if(!form.name.trim()) return;
    setState(s=>({...s,activities:[...s.activities,{...form,id:Date.now()}]}));
    setModal(false);setForm({name:'',icon:'ðŸŽ¯',color:COLORS[2],days:[],time:''});showToast('Actividad agregada');
  };
  const del=id=>{setState(s=>({...s,activities:s.activities.filter(x=>x.id!==id)}));showToast('Eliminada');};
  return React.createElement('div',null,
    React.createElement('div',{className:'page-header'},
      React.createElement('h1',{className:'page-title'},'ðŸƒ ',React.createElement('span',null,'Actividades')),
      React.createElement('button',{className:'btn btn-primary',onClick:()=>setModal(true)},React.createElement(Icon,{name:'plus',size:16}),'Actividad')
    ),
    state.activities.length===0&&React.createElement('div',{className:'card',style:{textAlign:'center',padding:40,color:'var(--text3)'}},'Gym, cursos, hobbies... agregÃ¡ tus actividades extracurriculares.'),
    React.createElement('div',{className:'grid-3'},
      state.activities.map(a=>React.createElement('div',{key:a.id,className:'card',style:{borderTop:`3px solid ${a.color}`}},
        React.createElement('div',{className:'flex justify-between'},
          React.createElement('div',null,
            React.createElement('div',{style:{fontSize:28,marginBottom:8}},a.icon),
            React.createElement('div',{style:{fontSize:15,fontWeight:700}},a.name),
            React.createElement('div',{className:'text-xs text-muted',style:{marginTop:4}},(a.days||[]).join(', ')||'Sin dÃ­as'),
            React.createElement('div',{className:'text-xs text-muted'},a.time||'Sin horario')
          ),
          React.createElement('button',{className:'btn btn-ghost btn-icon btn-sm',style:{color:'var(--text3)'},onClick:()=>del(a.id)},React.createElement(Icon,{name:'trash',size:14}))
        )
      ))
    ),
    modal&&React.createElement(Modal,{title:'Nueva Actividad',onClose:()=>setModal(false)},
      React.createElement('div',{className:'flex flex-col gap-3'},
        React.createElement('div',{className:'form-group'},React.createElement('label',{className:'label'},'Ãcono'),React.createElement('div',{className:'flex gap-2',style:{flexWrap:'wrap'}},ICONS.map(ic=>React.createElement('button',{key:ic,className:`btn btn-sm ${form.icon===ic?'btn-primary':'btn-ghost'}`,onClick:()=>setForm(f=>({...f,icon:ic}))},ic)))),
        React.createElement('div',{className:'form-group'},React.createElement('label',{className:'label'},'Nombre'),React.createElement('input',{className:'input',placeholder:'Ej: Gym',value:form.name,onChange:e=>setForm(f=>({...f,name:e.target.value}))})),
        React.createElement('div',{className:'form-group'},React.createElement('label',{className:'label'},'DÃ­as'),React.createElement(DayToggle,{options:['Lun','Mar','MiÃ©','Jue','Vie','SÃ¡b','Dom'],value:form.days,onChange:v=>setForm(f=>({...f,days:v}))})),
        React.createElement('div',{className:'form-group'},React.createElement('label',{className:'label'},'Horario'),React.createElement('input',{className:'input',placeholder:'07:00-08:00',value:form.time,onChange:e=>setForm(f=>({...f,time:e.target.value}))})),
        React.createElement('div',{className:'form-group'},React.createElement('label',{className:'label'},'Color'),React.createElement(ColorPicker,{value:form.color,onChange:c=>setForm(f=>({...f,color:c}))})),
        React.createElement('button',{className:'btn btn-primary w-full',style:{justifyContent:'center'},onClick:save},'Guardar')
      )
    )
  );
}

// â”€â”€â”€ TASKS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function Tasks({state,setState,showToast}) {
  const [filter,setFilter]=useState('all');
  const [modal,setModal]=useState(false);
  const [form,setForm]=useState({title:'',type:'facultad',subject:'',dueDate:'',priority:'media',status:'pendiente'});
  const PC={alta:'var(--red)',media:'var(--yellow)',baja:'var(--green)'};
  const filtered=state.tasks.filter(t=>{
    if(filter==='all') return true;
    if(['pendiente','en-progreso','completada'].includes(filter)) return t.status===filter;
    return t.type===filter;
  }).sort((a,b)=>({alta:0,media:1,baja:2}[a.priority]||1)-({alta:0,media:1,baja:2}[b.priority]||1));
  const toggle=id=>setState(s=>({...s,tasks:s.tasks.map(t=>t.id===id?{...t,status:t.status==='completada'?'pendiente':'completada'}:t)}));
  const save=()=>{
    if(!form.title.trim()) return;
    setState(s=>({...s,tasks:[...s.tasks,{...form,id:Date.now()}]}));
    setModal(false);setForm({title:'',type:'facultad',subject:'',dueDate:'',priority:'media',status:'pendiente'});showToast('Tarea agregada');
  };
  const del=id=>{setState(s=>({...s,tasks:s.tasks.filter(t=>t.id!==id)}));showToast('Tarea eliminada');};
  return React.createElement('div',null,
    React.createElement('div',{className:'page-header'},
      React.createElement('h1',{className:'page-title'},'âœ… ',React.createElement('span',null,'Tareas')),
      React.createElement('button',{className:'btn btn-primary',onClick:()=>setModal(true)},React.createElement(Icon,{name:'plus',size:16}),'Nueva')
    ),
    React.createElement('div',{className:'flex gap-2',style:{marginBottom:20,flexWrap:'wrap'}},
      [['all','Todas'],['pendiente','Pendientes'],['en-progreso','En Progreso'],['completada','Completadas'],['facultad','Facultad'],['hogar','Hogar'],['personal','Personal']]
      .map(([v,l])=>React.createElement('button',{key:v,className:`btn btn-sm ${filter===v?'btn-primary':'btn-ghost'}`,onClick:()=>setFilter(v)},l))
    ),
    filtered.length===0&&React.createElement('div',{className:'card',style:{textAlign:'center',padding:40,color:'var(--text3)'}},'No hay tareas en esta categorÃ­a.'),
    filtered.map(t=>React.createElement('div',{key:t.id,className:`task-item${t.status==='completada'?' done':''}`,style:{cursor:'default'}},
      React.createElement('div',{className:`task-check${t.status==='completada'?' checked':''}`,onClick:()=>toggle(t.id)},t.status==='completada'&&React.createElement('span',{style:{color:'white',fontSize:12}},'âœ“')),
      React.createElement('div',{className:'task-title'},t.title),
      React.createElement('div',{className:'task-meta'},
        React.createElement('div',{className:'badge',style:{background:PC[t.priority]+'22',color:PC[t.priority]}},t.priority),
        t.subject&&React.createElement('div',{className:'badge',style:{background:'var(--accent-glow)',color:'var(--accent)'}},t.subject),
        t.dueDate&&React.createElement('span',{className:'text-xs text-muted'},t.dueDate),
        React.createElement('button',{className:'btn btn-ghost btn-icon btn-sm',style:{color:'var(--text3)',width:28,height:28},onClick:()=>del(t.id)},React.createElement(Icon,{name:'trash',size:12}))
      )
    )),
    modal&&React.createElement(Modal,{title:'Nueva Tarea',onClose:()=>setModal(false)},
      React.createElement('div',{className:'flex flex-col gap-3'},
        React.createElement('div',{className:'form-group'},React.createElement('label',{className:'label'},'TÃ­tulo'),React.createElement('input',{className:'input',placeholder:'Ej: TP de Algoritmos',value:form.title,onChange:e=>setForm(f=>({...f,title:e.target.value}))})),
        React.createElement('div',{className:'grid-2',style:{gap:12}},
          React.createElement('div',{className:'form-group'},React.createElement('label',{className:'label'},'Tipo'),React.createElement('select',{className:'input select',value:form.type,onChange:e=>setForm(f=>({...f,type:e.target.value}))},['facultad','hogar','personal'].map(t=>React.createElement('option',{key:t,value:t},t)))),
          React.createElement('div',{className:'form-group'},React.createElement('label',{className:'label'},'Prioridad'),React.createElement('select',{className:'input select',value:form.priority,onChange:e=>setForm(f=>({...f,priority:e.target.value}))},['alta','media','baja'].map(p=>React.createElement('option',{key:p,value:p},p))))
        ),
        React.createElement('div',{className:'grid-2',style:{gap:12}},
          React.createElement('div',{className:'form-group'},
            React.createElement('label',{className:'label'},'Materia (opcional)'),
            React.createElement('select',{className:'input select',value:form.subject,onChange:e=>setForm(f=>({...f,subject:e.target.value}))},
              React.createElement('option',{value:''},'â€” Sin materia â€”'),
              state.subjects.map(s=>React.createElement('option',{key:s.id,value:s.name},s.name))
            )
          ),
          React.createElement('div',{className:'form-group'},React.createElement('label',{className:'label'},'Fecha lÃ­mite'),React.createElement('input',{className:'input',type:'date',value:form.dueDate,onChange:e=>setForm(f=>({...f,dueDate:e.target.value}))}))
        ),
        React.createElement('button',{className:'btn btn-primary w-full',style:{justifyContent:'center'},onClick:save},'Guardar Tarea')
      )
    )
  );
}

// â”€â”€â”€ HABITS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function Habits({state,setState,showToast}) {
  const [modal,setModal]=useState(false);
  const [form,setForm]=useState({name:'',icon:'â­'});
  const ICONS=['ðŸ’§','ðŸ˜´','ðŸƒ','ðŸ“–','ðŸ§˜','ðŸ¥—','â˜€ï¸','ðŸŽ¯','ðŸ’Š','âœï¸','ðŸŽ¸','ðŸŽ'];
  const DS=['L','M','X','J','V','S','D'];
  const toggle=(hid,i)=>setState(s=>({...s,habits:s.habits.map(h=>{
    if(h.id!==hid) return h;
    const done=h.done.includes(i)?h.done.filter(d=>d!==i):[...h.done,i];
    return {...h,done,streak:done.length};
  })}));
  const save=()=>{
    if(!form.name.trim()) return;
    setState(s=>({...s,habits:[...s.habits,{...form,id:Date.now(),done:[],streak:0}]}));
    setModal(false);setForm({name:'',icon:'â­'});showToast('HÃ¡bito agregado');
  };
  const del=id=>{setState(s=>({...s,habits:s.habits.filter(h=>h.id!==id)}));showToast('HÃ¡bito eliminado');};
  const totH=state.habits.length*7,doneH=state.habits.reduce((a,h)=>a+h.done.length,0);
  const wPct=Math.round(doneH/Math.max(totH,1)*100);
  return React.createElement('div',null,
    React.createElement('div',{className:'page-header'},
      React.createElement('h1',{className:'page-title'},'ðŸ’š ',React.createElement('span',null,'HÃ¡bitos')),
      React.createElement('button',{className:'btn btn-primary',onClick:()=>setModal(true)},React.createElement(Icon,{name:'plus',size:16}),'HÃ¡bito')
    ),
    React.createElement('div',{className:'card',style:{marginBottom:20}},
      React.createElement('div',{className:'card-title'},'Progreso Semanal'),
      React.createElement('div',{className:'flex items-center gap-3'},
        React.createElement('div',{style:{fontSize:36,fontWeight:800,color:'var(--green)',fontFamily:'var(--mono)',minWidth:80}},wPct+'%'),
        React.createElement('div',{style:{flex:1}},
          React.createElement('div',{className:'progress-bar',style:{height:10}},React.createElement('div',{className:'progress-fill',style:{width:wPct+'%',background:'var(--green)'}})),
          React.createElement('div',{className:'text-xs text-muted',style:{marginTop:6}},doneH,' de ',totH,' checks esta semana')
        )
      )
    ),
    React.createElement('div',{style:{display:'flex',marginBottom:12,paddingLeft:220,gap:4}},DS.map(d=>React.createElement('div',{key:d,style:{width:28,textAlign:'center',fontSize:11,color:'var(--text3)',fontWeight:700}},d))),
    state.habits.length===0&&React.createElement('div',{className:'card',style:{textAlign:'center',padding:40,color:'var(--text3)'}},'EmpezÃ¡ con un hÃ¡bito pequeÃ±o. Â¡La constancia hace la diferencia!'),
    state.habits.map(h=>React.createElement('div',{key:h.id,className:'habit-item'},
      React.createElement('div',{style:{fontSize:22,width:32,textAlign:'center'}},h.icon),
      React.createElement('div',{style:{minWidth:150}},
        React.createElement('div',{style:{fontSize:14,fontWeight:600}},h.name),
        React.createElement('div',{style:{fontSize:12,color:'var(--text3)'}},h.streak,' dÃ­as ðŸ”¥')
      ),
      React.createElement('div',{style:{display:'flex',gap:4,flex:1}},
        DS.map((_,i)=>React.createElement('div',{key:i,className:`habit-dot${h.done.includes(i)?' done':''}`,onClick:()=>toggle(h.id,i)},h.done.includes(i)?'âœ“':''))
      ),
      React.createElement('button',{className:'btn btn-ghost btn-icon btn-sm',style:{color:'var(--text3)',marginLeft:8},onClick:()=>del(h.id)},React.createElement(Icon,{name:'trash',size:12}))
    )),
    modal&&React.createElement(Modal,{title:'Nuevo HÃ¡bito',onClose:()=>setModal(false)},
      React.createElement('div',{className:'flex flex-col gap-3'},
        React.createElement('div',{className:'form-group'},React.createElement('label',{className:'label'},'Ãcono'),React.createElement('div',{className:'flex gap-2',style:{flexWrap:'wrap'}},ICONS.map(ic=>React.createElement('button',{key:ic,className:`btn btn-sm ${form.icon===ic?'btn-primary':'btn-ghost'}`,onClick:()=>setForm(f=>({...f,icon:ic}))},ic)))),
        React.createElement('div',{className:'form-group'},React.createElement('label',{className:'label'},'Nombre'),React.createElement('input',{className:'input',placeholder:'Ej: Tomar agua',value:form.name,onChange:e=>setForm(f=>({...f,name:e.target.value}))})),
        React.createElement('button',{className:'btn btn-primary w-full',style:{justifyContent:'center'},onClick:save},'Guardar HÃ¡bito')
      )
    )
  );
}

// â”€â”€â”€ STATS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function Stats({state}) {
  const total=state.tasks.length,done=state.tasks.filter(t=>t.status==='completada').length;
  const pct=Math.round(done/Math.max(total,1)*100);
  const habPct=Math.round(state.habits.reduce((a,h)=>a+Math.min(h.done.length,7),0)/Math.max(state.habits.length*7,1)*100);
  const r=60,circ=2*Math.PI*r;
  const SC=(l,v,s,c)=>React.createElement('div',{className:'stat-card'},React.createElement('div',{className:'stat-num',style:{color:c}},v),React.createElement('div',{className:'stat-label'},l),React.createElement('div',{style:{fontSize:11,color:'var(--text3)'}},s));
  return React.createElement('div',null,
    React.createElement('div',{className:'page-header'},React.createElement('h1',{className:'page-title'},'ðŸ“Š ',React.createElement('span',null,'EstadÃ­sticas'))),
    React.createElement('div',{className:'grid-4'},
      SC('Materias',state.subjects.length,'activas','#7c6af7'),
      SC('Actividades',state.activities.length,'registradas','#fb923c'),
      SC('Tareas',`${done}/${total}`,'completadas','#4ade80'),
      SC('HÃ¡bitos',habPct+'%','semanal','#22d3ee')
    ),
    React.createElement('div',{className:'grid-2',style:{gap:20}},
      React.createElement('div',{className:'card'},
        React.createElement('div',{className:'card-title'},'Progreso de Tareas'),
        React.createElement('div',{style:{textAlign:'center',padding:'20px 0'}},
          React.createElement('svg',{width:150,height:150,viewBox:'0 0 150 150'},
            React.createElement('circle',{cx:75,cy:75,r,fill:'none',stroke:'var(--bg3)',strokeWidth:12}),
            React.createElement('circle',{cx:75,cy:75,r,fill:'none',stroke:'var(--green)',strokeWidth:12,strokeDasharray:circ,strokeDashoffset:circ*(1-pct/100),strokeLinecap:'round',transform:'rotate(-90 75 75)',style:{transition:'stroke-dashoffset 0.6s'}}),
            React.createElement('text',{x:75,y:71,textAnchor:'middle',fill:'var(--text)',fontSize:28,fontWeight:800,fontFamily:'Space Mono'},pct+'%'),
            React.createElement('text',{x:75,y:88,textAnchor:'middle',fill:'var(--text3)',fontSize:11},'completado')
          )
        ),
        ['facultad','hogar','personal'].map(tp=>{
          const c=state.tasks.filter(t=>t.type===tp).length;
          return React.createElement('div',{key:tp,style:{marginBottom:12}},
            React.createElement('div',{className:'flex justify-between text-sm',style:{marginBottom:4}},React.createElement('span',{style:{textTransform:'capitalize'}},tp),React.createElement('span',{className:'text-muted'},c,' tareas')),
            React.createElement('div',{className:'progress-bar'},React.createElement('div',{className:'progress-fill',style:{width:`${c/Math.max(total,1)*100}%`,background:'var(--accent)'}}))
          );
        })
      ),
      React.createElement('div',{className:'card'},
        React.createElement('div',{className:'card-title'},'HÃ¡bitos por DÃ­a'),
        ['L','M','X','J','V','S','D'].map((d,i)=>{
          const c=state.habits.filter(h=>h.done.includes(i)).length;
          const pp=Math.round(c/Math.max(state.habits.length,1)*100);
          return React.createElement('div',{key:d,style:{marginBottom:10}},
            React.createElement('div',{className:'flex justify-between text-sm',style:{marginBottom:4}},React.createElement('span',null,d),React.createElement('span',{className:'text-muted'},c,'/',state.habits.length)),
            React.createElement('div',{className:'progress-bar'},React.createElement('div',{className:'progress-fill',style:{width:pp+'%',background:pp>70?'var(--green)':pp>40?'var(--yellow)':'var(--red)'}}))
          );
        })
      )
    )
  );
}

// â”€â”€â”€ FOCUS / POMODORO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function Focus({state}) {
  const [mins,setMins]=useState(25),[secs,setSecs]=useState(0);
  const [running,setRunning]=useState(false),[session,setSession]=useState('work');
  const [count,setCount]=useState(0),[subject,setSubject]=useState('');
  const timer=useRef(null);
  const total=(session==='work'?25:5)*60,elapsed=total-(mins*60+secs),pct=elapsed/total,r=90,circ=2*Math.PI*r;
  useEffect(()=>{
    if(running){timer.current=setInterval(()=>{setSecs(s=>{if(s===0){setMins(m=>{if(m===0){setRunning(false);const nx=session==='work'?'break':'work';setSession(nx);setMins(nx==='work'?25:5);if(session==='work')setCount(c=>c+1);return nx==='work'?25:5;}return m-1;});return 59;}return s-1;});},1000);}
    else clearInterval(timer.current);
    return()=>clearInterval(timer.current);
  },[running,session]);
  const reset=()=>{setRunning(false);setMins(25);setSecs(0);setSession('work');};
  return React.createElement('div',null,
    React.createElement('div',{className:'page-header'},React.createElement('h1',{className:'page-title'},'ðŸ§  ',React.createElement('span',null,'Modo Enfoque'))),
    React.createElement('div',{className:'grid-2',style:{gap:20}},
      React.createElement('div',{className:'card',style:{display:'flex',flexDirection:'column',alignItems:'center',padding:40}},
        React.createElement('div',{className:'tabs',style:{marginBottom:24,maxWidth:240,width:'100%'}},
          [['work','Trabajo'],['break','Descanso']].map(([s,l])=>React.createElement('button',{key:s,className:`tab${session===s?' active':''}`,onClick:()=>{if(!running){setSession(s);setMins(s==='work'?25:5);setSecs(0);}}},l))
        ),
        React.createElement('div',{style:{position:'relative',width:200,height:200,display:'flex',alignItems:'center',justifyContent:'center',margin:'0 auto'}},
          React.createElement('svg',{style:{position:'absolute',top:0,left:0,transform:'rotate(-90deg)'},width:200,height:200,viewBox:'0 0 200 200'},
            React.createElement('circle',{cx:100,cy:100,r,fill:'none',stroke:'var(--bg3)',strokeWidth:10}),
            React.createElement('circle',{cx:100,cy:100,r,fill:'none',stroke:session==='work'?'var(--accent)':'var(--green)',strokeWidth:10,strokeDasharray:circ,strokeDashoffset:circ*(1-pct),strokeLinecap:'round',style:{transition:'stroke-dashoffset 0.5s'}})
          ),
          React.createElement('div',{style:{textAlign:'center'}},
            React.createElement('div',{style:{fontFamily:'var(--mono)',fontSize:42,fontWeight:700,letterSpacing:-2}},`${p2(mins)}:${p2(secs)}`),
            React.createElement('div',{style:{fontSize:12,color:'var(--text3)',marginTop:4}},session==='work'?'TrabajÃ¡':'DescansÃ¡')
          )
        ),
        React.createElement('div',{className:'flex gap-3',style:{marginTop:28}},
          React.createElement('button',{className:'btn btn-ghost',onClick:reset},'â†º Reset'),
          React.createElement('button',{className:'btn btn-primary',style:{minWidth:120,justifyContent:'center'},onClick:()=>setRunning(r=>!r)},running?'â¸ Pausa':'â–¶ Iniciar')
        ),
        React.createElement('div',{style:{marginTop:16,color:'var(--text2)',fontSize:13}},`ðŸ… ${count} sesiones completadas`)
      ),
      React.createElement('div',{className:'flex flex-col gap-4'},
        React.createElement('div',{className:'card'},
          React.createElement('div',{className:'card-title'},'SesiÃ³n Actual'),
          React.createElement('div',{className:'form-group'},
            React.createElement('label',{className:'label'},'Asociar a materia'),
            React.createElement('select',{className:'input select',value:subject,onChange:e=>setSubject(e.target.value)},
              React.createElement('option',{value:''},'â€” Sin materia â€”'),
              state.subjects.map(s=>React.createElement('option',{key:s.id,value:s.name},s.name))
            )
          )
        ),
        React.createElement('div',{className:'card'},
          React.createElement('div',{className:'card-title'},'La tÃ©cnica Pomodoro'),
          ['ðŸŽ¯ TrabajÃ¡ 25 minutos sin distracciones','â˜• DescansÃ¡ 5 minutos','ðŸ… Cada 4 sesiones, tomÃ¡ un descanso largo','ðŸ“µ SilenciÃ¡ notificaciones durante la sesiÃ³n'].map((t,i)=>
            React.createElement('div',{key:i,style:{fontSize:13,color:'var(--text2)',padding:'10px 0',borderBottom:'1px solid var(--border)'}},t)
          )
        )
      )
    )
  );
}

// â”€â”€â”€ NOTES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function Notes({state,setState,showToast}) {
  const [modal,setModal]=useState(false);
  const [form,setForm]=useState({content:'',subject:'',color:COLORS[0]});
  const save=()=>{
    if(!form.content.trim()) return;
    setState(s=>({...s,notes:[{...form,id:Date.now(),date:todayStr()},...s.notes]}));
    setModal(false);setForm({content:'',subject:'',color:COLORS[0]});showToast('Nota guardada');
  };
  const del=id=>setState(s=>({...s,notes:s.notes.filter(n=>n.id!==id)}));
  return React.createElement('div',null,
    React.createElement('div',{className:'page-header'},
      React.createElement('h1',{className:'page-title'},'ðŸ“ ',React.createElement('span',null,'Notas')),
      React.createElement('button',{className:'btn btn-primary',onClick:()=>setModal(true)},React.createElement(Icon,{name:'plus',size:16}),'Nota')
    ),
    state.notes.length===0&&React.createElement('div',{className:'card',style:{textAlign:'center',padding:40,color:'var(--text3)'}},'Sin notas todavÃ­a. Â¡CreÃ¡ la primera!'),
    React.createElement('div',{className:'grid-3'},
      state.notes.map(n=>React.createElement('div',{key:n.id,className:'card',style:{background:n.color+'18',border:`1px solid ${n.color}44`,padding:16}},
        React.createElement('div',{className:'flex justify-between',style:{marginBottom:8,minHeight:20}},
          n.subject?React.createElement('span',{style:{fontSize:11,fontWeight:700,color:n.color,textTransform:'uppercase',letterSpacing:1}},n.subject):React.createElement('span'),
          React.createElement('button',{style:{background:'none',border:'none',color:'var(--text3)',cursor:'pointer',fontSize:18,lineHeight:1,padding:0},onClick:()=>del(n.id)},'Ã—')
        ),
        React.createElement('div',{style:{fontSize:13,lineHeight:1.6}},n.content),
        React.createElement('div',{style:{marginTop:12,fontSize:11,color:'var(--text3)'}},n.date)
      ))
    ),
    modal&&React.createElement(Modal,{title:'Nueva Nota',onClose:()=>setModal(false)},
      React.createElement('div',{className:'flex flex-col gap-3'},
        React.createElement('div',{className:'form-group'},React.createElement('label',{className:'label'},'Nota'),React.createElement('textarea',{className:'input',rows:4,placeholder:'EscribÃ­ tu nota...',value:form.content,onChange:e=>setForm(f=>({...f,content:e.target.value})),style:{resize:'vertical'}})),
        React.createElement('div',{className:'form-group'},
          React.createElement('label',{className:'label'},'Materia (opcional)'),
          React.createElement('select',{className:'input select',value:form.subject,onChange:e=>setForm(f=>({...f,subject:e.target.value}))},
            React.createElement('option',{value:''},'â€” General â€”'),
            state.subjects.map(s=>React.createElement('option',{key:s.id,value:s.name},s.name))
          )
        ),
        React.createElement('div',{className:'form-group'},React.createElement('label',{className:'label'},'Color'),React.createElement(ColorPicker,{value:form.color,onChange:c=>setForm(f=>({...f,color:c}))})),
        React.createElement('button',{className:'btn btn-primary w-full',style:{justifyContent:'center'},onClick:save},'Guardar')
      )
    )
  );
}

// â”€â”€â”€ PROFILE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function Profile({user,onLogout,state}) {
  return React.createElement('div',null,
    React.createElement('div',{className:'page-header'},React.createElement('h1',{className:'page-title'},'ðŸ‘¤ ',React.createElement('span',null,'Mi Perfil'))),
    React.createElement('div',{className:'grid-2',style:{gap:20,alignItems:'start'}},
      React.createElement('div',{className:'card'},
        React.createElement('div',{className:'flex items-center gap-4',style:{marginBottom:24}},
          React.createElement('div',{style:{width:64,height:64,borderRadius:'50%',background:'var(--accent)',display:'flex',alignItems:'center',justifyContent:'center',fontSize:28,fontWeight:700,color:'#fff',flexShrink:0}},
            (user.displayName||user.email||'?')[0].toUpperCase()
          ),
          React.createElement('div',null,
            React.createElement('div',{style:{fontSize:20,fontWeight:700}},user.displayName||'Sin nombre'),
            React.createElement('div',{className:'text-sm text-muted'},user.email),
            React.createElement('div',{style:{fontSize:11,color:'var(--green)',marginTop:4}},'â— Conectado via Firebase')
          )
        ),
        React.createElement('hr',{className:'divider'}),
        React.createElement('p',{className:'text-sm text-muted',style:{marginBottom:20,lineHeight:1.6}},'Tus datos se guardan automÃ¡ticamente en Firebase Firestore. PodÃ©s acceder desde cualquier dispositivo.'),
        React.createElement('button',{className:'btn btn-danger',style:{justifyContent:'center'},onClick:onLogout},
          React.createElement(Icon,{name:'logout',size:16}),' Cerrar SesiÃ³n'
        )
      ),
      React.createElement('div',{className:'card'},
        React.createElement('div',{className:'card-title'},'Resumen'),
        [
          ['ðŸ“š Materias',state.subjects.length],
          ['ðŸƒ Actividades',state.activities.length],
          ['âœ… Tareas',state.tasks.length],
          ['ðŸ’š HÃ¡bitos',state.habits.length],
          ['ðŸ“ Notas',state.notes.length],
          ['ðŸ“… Eventos',state.events.length],
        ].map(([l,v])=>React.createElement('div',{key:l,className:'flex justify-between',style:{padding:'10px 0',borderBottom:'1px solid var(--border)',fontSize:14}},
          React.createElement('span',{className:'text-muted'},l),
          React.createElement('span',{style:{fontWeight:700}},v)
        ))
      )
    )
  );
}

// â”€â”€â”€ APP ROOT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const NAV_ITEMS = [
  {id:'dashboard',label:'Panel',icon:'home'},
  {id:'calendar',label:'Calendario',icon:'calendar'},
  {id:'faculty',label:'Facultad',icon:'book'},
  {id:'activities',label:'Actividades',icon:'activity'},
  {id:'tasks',label:'Tareas',icon:'check'},
  {id:'habits',label:'HÃ¡bitos',icon:'heart'},
  {id:'stats',label:'Stats',icon:'chart'},
  {id:'focus',label:'Enfoque',icon:'focus'},
  {id:'notes',label:'Notas',icon:'note'},
  {id:'profile',label:'Perfil',icon:'user'},
];

function App() {
  const [user,setUser]       = useState(null);
  const [data,setDataRaw]    = useState(null);
  const [page,setPage]       = useState('dashboard');
  const [toast,setToast]     = useState(null);
  const [saving,setSaving]   = useState(false);
  const [booting,setBooting] = useState(true);
  const saveTimer            = useRef(null);

  // Escuchar cambios de sesiÃ³n de Firebase
  useEffect(()=>{
    const unsub = auth.onAuthStateChanged(async fbUser => {
      if(fbUser) {
        setUser(fbUser);
        try {
          let d = await loadData(fbUser.uid);
          if(!d){ d=BLANK(); await saveData(fbUser.uid,d); }
          setDataRaw(d);
          document.body.className = d.theme==='light'?'light':'';
        } catch(e){ console.error(e); }
      } else {
        setUser(null);
        setDataRaw(null);
      }
      setBooting(false);
    });
    return ()=>unsub();
  },[]);

  // setData con auto-guardado en Firestore
  const setData = useCallback((fn)=>{
    setDataRaw(prev=>{
      const next = typeof fn==='function' ? fn(prev) : fn;
      document.body.className = next.theme==='light'?'light':'';
      clearTimeout(saveTimer.current);
      saveTimer.current = setTimeout(async()=>{
        if(!user) return;
        setSaving(true);
        try { await saveData(user.uid, next); }
        catch(e){ console.error('Error guardando:', e); }
        setSaving(false);
      }, 800);
      return next;
    });
  },[user]);

  const showToast = (msg,type='success') => setToast({msg,type});

  const handleLogout = async () => {
    await auth.signOut();
    showToast('SesiÃ³n cerrada','info');
  };

  const toggleTheme = () => data && setData(s=>({...s,theme:s.theme==='dark'?'light':'dark'}));

  // Splash inicial
  if(booting) return React.createElement('div',{className:'splash'},
    React.createElement('div',{className:'splash-logo'},'Orbi'),
    React.createElement('div',{className:'spinner'}),
    React.createElement('div',{className:'splash-sub'},'Conectando con Firebase...')
  );

  // Auth
  if(!user || !data) return React.createElement(React.Fragment,null,
    React.createElement(AuthPage,{onAuth:()=>{}}),
    toast&&React.createElement(Toast,{msg:toast.msg,type:toast.type,onDone:()=>setToast(null)})
  );

  const PAGES = {
    dashboard:  React.createElement(Dashboard,  {state:data,setPage,user}),
    calendar:   React.createElement(Calendar,   {state:data,setState:setData,showToast}),
    faculty:    React.createElement(Faculty,    {state:data,setState:setData,showToast}),
    activities: React.createElement(Activities, {state:data,setState:setData,showToast}),
    tasks:      React.createElement(Tasks,      {state:data,setState:setData,showToast}),
    habits:     React.createElement(Habits,     {state:data,setState:setData,showToast}),
    stats:      React.createElement(Stats,      {state:data}),
    focus:      React.createElement(Focus,      {state:data}),
    notes:      React.createElement(Notes,      {state:data,setState:setData,showToast}),
    profile:    React.createElement(Profile,    {user,onLogout:handleLogout,state:data}),
  };

  return React.createElement(React.Fragment,null,
    // Indicador de guardado
    saving && React.createElement('div',{style:{position:'fixed',top:12,right:12,zIndex:9999,fontSize:11,color:'var(--text3)',background:'var(--bg2)',border:'1px solid var(--border)',borderRadius:8,padding:'4px 10px',display:'flex',alignItems:'center',gap:6}},
      React.createElement('div',{className:'spinner',style:{width:12,height:12,borderWidth:2}}),'Guardando...'
    ),

    React.createElement('nav',{className:'nav'},
      React.createElement('div',{className:'nav-logo'},'O'),
      NAV_ITEMS.map(item=>React.createElement('button',{
        key:item.id,
        className:`nav-item${page===item.id?' active':''}`,
        title:item.label,
        onClick:()=>setPage(item.id)
      },React.createElement(Icon,{name:item.icon,size:20}))),
      React.createElement('div',{className:'nav-bottom'},
        React.createElement('button',{className:'nav-item',title:'Cambiar tema',onClick:toggleTheme},
          data.theme==='dark'?React.createElement(Icon,{name:'sun',size:18}):React.createElement(Icon,{name:'moon',size:18})
        )
      )
    ),

    React.createElement('main',{className:'main'},
      PAGES[page] || PAGES.dashboard
    ),

    toast&&React.createElement(Toast,{msg:toast.msg,type:toast.type||'success',onDone:()=>setToast(null)})
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(React.createElement(App));
</script>
</body>
</html>